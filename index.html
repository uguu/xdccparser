<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<title>XDCC</title>

<link href='http://fonts.googleapis.com/css?family=Droid+Sans' rel='stylesheet' type='text/css'>
<link rel="stylesheet" type="text/css" href="style.css" />
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.min.js"></script>
<script class="jsbin" src="http://datatables.net/download/build/jquery.dataTables.nightly.js"></script>

<script type="text/javascript">

$(document).ready( function () {
  var datatable = $('#packlisttable').dataTable( {
    'bFilter' : true,
    'sDom': 'lrt',
    'bPaginate': false,
    'oSearch' : { 'bRegex': true },
  });
  
  var infotable = $('#infotable').dataTable( {
    'bFilter' : false,
    'sDom': 'lrt',
    'bPaginate': false,
    'bSort': false,
  });

  $("#searchbox").keyup(function () {
    datatable.fnFilter(this.value, 2, true, true);
   });
  
  $("#body").keydown(function(key) {
    if ( key.keyCode >= 45 ) {
      document.getElementById('searchbox').focus();
    } else if ( ( key.keyCode < 8 || key.keyCode >18 ) && key.keyCode != 32 ) {
      document.getElementById('searchbox').blur();
    }
  });

  $('#packlisttable tbody').click(function(event) {
    var tr = event.target.parentNode;
    
    var str = '/msg ' + botnick + ' XDCC SEND ' + tr.childNodes[0].childNodes[0].nodeValue;

    window.prompt('Copy and paste this into your IRC client', str);
  });
  var botnick; //scope etc
  var parseIrofferXML = function(xml) {
    botnick = xml.getElementsByTagName('currentnick')[0].childNodes[0].nodeValue;
    var packs = xml.getElementsByTagName('pack');
  
    for (i=0; i<packs.length; i++) {
      var pack = packs[i];
      var packnr = pack.getElementsByTagName('packnr')[0].childNodes[0].nodeValue;
      var packgets = pack.getElementsByTagName('packgets')[0].childNodes[0].nodeValue;
      var packname = pack.getElementsByTagName('packname')[0].childNodes[0].nodeValue;
      var packbytes = pack.getElementsByTagName('packbytes')[0].childNodes[0].nodeValue;
      var groupname = pack.getElementsByTagName('groupname')[0].childNodes[0].nodeValue;
      //var packmd5 = pack.getElementsByTagName('md5sum')[0].childNodes[0].nodeValue;

      datatable.fnAddData( [packnr, packgets, packname, packbytes, groupname] );
    }
  };

  var parseInfoXML = function(xml) {
    var data = new Array(0);
    var name = new Array(0);
    data.push(xml.getElementsByTagName('transferedtotal')[0].childNodes[0].nodeValue);
    data.push(xml.getElementsByTagName('slotsfree')[0].childNodes[0].nodeValue + '/' + xml.getElementsByTagName('slotsmax')[0].childNodes[0].nodeValue);
    data.push(xml.getElementsByTagName('queueuse')[0].childNodes[0].nodeValue + '/' + xml.getElementsByTagName('queuemax')[0].childNodes[0].nodeValue);
    data.push(xml.getElementsByTagName('queueuse')[1].childNodes[0].nodeValue + '/' + xml.getElementsByTagName('queuemax')[1].childNodes[0].nodeValue);
    data.push(xml.getElementsByTagName('banduse')[0].childNodes[0].nodeValue);
    data.push(botnick);
    data.push(xml.getElementsByTagName('uptime')[0].childNodes[0].nodeValue);
    name.push('Transferred');
    name.push('Free Slots');
    name.push('Queue');
    name.push('Idlequeue');
    name.push('Curr. Bandwidth');
    name.push('Nick');
    name.push('Uptime');
    for (i=0; i<data.length; i++) {
      infotable.fnAddData( [name[i], data[i]] );
    }
  }

  $.get('drawn-reality.packlist.xml', function(xml) {
    parseIrofferXML(xml);
    parseInfoXML(xml);
    datatable.fnAdjustColumnSizing();
    infotable.fnAdjustColumnSizing();
  });
});

</script>
</head>
<body id="body">
<div id="packlist">
  <table id="packlisttable" width="100%">
    <thead>
      <tr>
        <th>Pack</th>
        <th>Gets</th>
        <th>Name</th>
        <th>Size (bytes)</th>
        <th>Group</th>
      </tr>
    </thead>
    <tbody>
    </tbody>
  </table>
</div>
<div id="search">
  <input id="searchbox" type="text" />
</div>
<div id="info">
  <table id="infotable" width="100%">
    <thead>
      <tr>
        <th>key</th>
        <th>value</th>
      </tr>
    </thead>
    <tbody>
      <tr>
      <th></th>
      <th></th>
      </tr>
    </tbody>
  </table>
</div>
<noscript>
<div id="JABASCIRPT">
  YO DAWG YOU GOTS TO ENABLE TEH JABASCIRPT
</div>
</noscript>
</body>